# Swift コード生成ルール

このドキュメントでは、AIを使用したSwiftコード生成時に適用すべきルールとベストプラクティスを提供します。

## コードスタイル

1. **命名規則**
   - クラス、構造体、列挙型は UpperCamelCase を使用
   - メソッド、プロパティ、変数、パラメータは lowerCamelCase を使用
   - 定数には静的な意味を持つ場合は UPPER_SNAKE_CASE を使用
   - ブール値のプロパティや変数は `is`, `has`, `should` などの接頭辞を使用

2. **インデント**
   - タブではなくスペース4つを使用
   - 複数行にわたる文は適切にインデント

3. **ブレース**
   - 開始ブレースは宣言と同じ行に配置
   - 終了ブレースは新しい行に配置

## アーキテクチャパターン

1. **MVC (Model-View-Controller)**
   - データと表示を明確に分離
   - コントローラーにビジネスロジックを集中させない

2. **MVVM (Model-View-ViewModel)**
   - ViewModelはViewの状態を保持
   - ViewModelはModelからデータを取得し加工
   - BindingやObservableを使用して変更を通知

3. **Clean Architecture**
   - UseCases（Interactor）でビジネスロジックをカプセル化
   - Entityでビジネスモデルを定義
   - Repositoryでデータソースへのアクセスを抽象化

## SwiftUIのベストプラクティス

1. **ビューの分割**
   - 大きなビューは小さなコンポーネントに分割
   - 再利用可能なコンポーネントを作成
   - 複雑な条件付きビューは別のビューに抽出

2. **状態管理**
   - `@State`は単純な内部状態に使用
   - `@Binding`は親ビューから値を受け取る場合に使用
   - `@ObservedObject`や`@StateObject`は複雑な状態管理に使用
   - `@EnvironmentObject`はアプリ全体で共有する状態に使用

3. **パフォーマンス最適化**
   - 頻繁に変更される状態と静的なビューを分離
   - 重い計算は非同期処理やバックグラウンドスレッドに移動
   - `Identifiable`プロトコルを実装してコレクションビューのパフォーマンスを向上

## UIKitのベストプラクティス

1. **Auto Layout**
   - Interface Builderよりコードでの制約設定を推奨
   - VisualFormatLanguageより`NSLayoutConstraint`での明示的な制約を推奨
   - 複雑なレイアウトは`UIStackView`を活用

2. **メモリ管理**
   - 循環参照を避けるため、クロージャ内では`[weak self]`を使用
   - デリゲートパターンでは弱参照を使用
   - 大きなオブジェクトは使用後に`nil`を代入してメモリを解放

3. **ライフサイクル管理**
   - `viewDidLoad`では初期化のみを行い、データ取得などは`viewWillAppear`で実行
   - `deinit`でリソースの解放を適切に行う
   - メモリ警告に対応するハンドラを実装

## エラー処理

1. **エラータイプ**
   - カスタムエラー型は`Error`プロトコルに準拠
   - エラーメッセージには具体的な情報を含める
   - エラーケースは明確に命名

2. **エラーハンドリング**
   - `do-catch`ブロックで例外を捕捉
   - `try?`や`try!`の使用は最小限に
   - 必要に応じて`Result<Success, Failure>`型を使用

## セキュリティ

1. **データ保存**
   - 機密情報はKeychainを使用
   - UserDefaultsには機密情報を保存しない
   - 必要に応じてデータを暗号化

2. **ネットワーク通信**
   - HTTPSを使用
   - 証明書ピンニングを考慮
   - センシティブなデータはリクエストヘッダーに含めない

3. **入力検証**
   - ユーザー入力は必ず検証
   - SQLインジェクションやXSSを防止
   - 入力制限を適切に設定

## テスト

1. **ユニットテスト**
   - ビジネスロジックは完全にテスト
   - モックやスタブを使用して依存関係を分離
   - 境界条件のテストを含める

2. **UIテスト**
   - 主要なユーザーフローをテスト
   - アクセシビリティ識別子を使用
   - デバイスの向きや画面サイズの変更をテスト

## ドキュメンテーション

1. **コメント**
   - 複雑なロジックに説明コメントを追加
   - パブリックAPIは完全にドキュメント化
   - コメントはMarkdown形式で記述

2. **ドキュメントコメント**
   - クラス、構造体、列挙型の目的を説明
   - パラメータと戻り値の意味を明記
   - 例外がスローされる条件を記述

## コード生成時の注意点

1. **AI生成コードのレビュー**
   - 生成されたコードは常に手動でレビュー
   - コードスタイルがプロジェクト規約に従っていることを確認
   - 不要なimportや未使用のコードを削除

2. **最新のSwift機能**
   - 対象のSwiftバージョンで利用可能な機能のみを使用
   - 古いAPIよりモダンなSwift APIを優先
   - 非推奨（deprecated）のAPIの使用を避ける

3. **パフォーマンス考慮**
   - 大量のデータ処理にはパフォーマンスを最適化
   - メインスレッドをブロックしない
   - メモリリークを避ける設計